<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>测量数据输入</title>
    <script src="../js/mui.min.js"></script>
	<script src="../js/vue.min.js"></script>
	<script src="../js/jquery-2.1.4.min.js"></script> 
	<script src="../js/app.js"></script> 
	<script type="text/javascript" src="../js/mui.picker.js" ></script>
	<script type="text/javascript" src="../js/mui.poppicker.js" ></script>
    <link href="../css/mui.css" rel="stylesheet"/> 
    <link href="../css/app.css" rel="stylesheet"/> 
    <link href="../css/tasks_page.css" rel="stylesheet"/> 
    <link href="../css/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/mui.picker.min.css" />
    <link rel="stylesheet" href="../css/mui.poppicker.css" />
    <style>
    
	
    </style>
</head>
<body>
	<div id="task_input_meter_content">
		
	<header class="mui-bar mui-bar-nav top_title" >
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">测量数据输入</h1>
		<i class="fa fa-save" @tap="saveMeterInput()" style="font-size: 1.7em; color: #ffffff; margin: 0.2em; float: right;"></i>
	</header>
 
   
 
	<div id="item1" class=" mui-content "  >
		 <table >
		 	<tr class="tr_title">
		 		<th>工序流转卡号</th>
		 		<th>图号</th>
		 		<th>品名</th>
		 		<th>数量</th>
		 		<th>检查完成</th>
		 		<th>接受时间</th>
		 	</tr>
		 	<tr class="tr_content" v-for="item in taskList">
		 		<td>{{item.ProcessFlow_CD}}</td>
		 		<td>{{item.FNumber}}</td>
		 		<td>{{item.FName}}</td>
		 		<td>{{item.TaskCount}}</td>
		 		<td>{{item.FinishCount}}</td>
		 		<td>{{item.ReceiveDttm}}</td>
		 	</tr>
		 </table>
		 <table >
		 	<tr class="tr_title">
		 		<th width="15%">测量项目</th>
		 		<th width="20%">工具</th>
		 		<th width="10%">单位</th>
		 		<!--<th width="10%">测定<br>尺寸</th>-->
		 		<th width="15%">公差正<br>公差负</th>
		 		
		 		<th width="10%">样本数</th>
		 		<th width="10%">完成数</th>
		 	</tr>
		 	<tr class="tr_content" v-for="detailItem in detailItemList">
		 		<td>{{detailItem.ItemID}}</td>
		 		<td>{{detailItem.Tools}}</td>
		 		<td>{{detailItem.Unit}}</td>
		 		<!---->
		 		<td>{{detailItem.BaseTolerance}}</td> 
		 		
		 		<td>{{detailItem.Qty}}</td> 
		 		<td>{{detailItem.FinishQty}}</td> 
		 	</tr>
		 </table>
		 
		 <table >
		 	<tr class="tr_content" v-for="meterItem in meterItemList">
		 		<td width="20%">钢印号：{{meterItem.Model}}</td>
		 		<td style="padding: 2px 10px;"><input type="number" v-model="meterItem.Result"  style="margin: 2px;"  placeholder="请输入"></td>
		 	</tr>
		 </table>
		 
	</div>
	
 
</div>
<script type="text/javascript" charset="UTF-8">
  	mui.init(); 
  	var vm_task_input_meter = new Vue({
		el: '#task_input_meter_content',
		data: {
			checkAllFlag:false,
			selectItemIds:[],
			taskSearchInfo:{
				command:"detail",
				message:"",
				data:""
			},
			userInfo:{
//				LoginUser:"user2",
//				LoginNumber:1554,
//				GroupName:'检查组长'
			},
			taskList:[
			],
			detailItemList:[],
			meterItemList:[]
		},computed: {
		    isAdmin:function(){
		    	return this.userInfo.GroupName=='检查组长';
		    } 
		    
		},
		methods:{
		}
	});
	
	
	mui.ready(function(){
		vm_task_input_meter.userInfo = app.getState();
		getTaskDetail();
	});
	
   
	function  getTaskDetail(){
		var userInfo = app.getState();
		var searchData=userInfo;
		var selectTask=app.getPageParam("$selectInputTaskItem");
		vm_task_input_meter.taskList=[];
		vm_task_input_meter.taskList.push(selectTask);
		
		
		var selectProject=app.getPageParam("$selectCheckInputDetailItems");
		vm_task_input_meter.detailItemList=[];
		vm_task_input_meter.detailItemList.push(selectProject);	
		 
		searchData.ProcessFlow_CD=selectTask.ProcessFlow_CD;
		searchData.FNumber=selectTask.FNumber;
		searchData.SEQ=selectProject.SEQ;
		vm_task_input_meter.taskSearchInfo.command="load";
		vm_task_input_meter.taskSearchInfo.data=""+JSON.stringify(searchData);
		app.postCheckList(vm_task_input_meter.taskSearchInfo,function(data){
			if(data.code==1){
				var dataList = data.data; 
				console.info(dataList);
				var AllList=JSON.parse(dataList);
				
				var selectTaskInputDetailItems=app.getPageParam("$selectTaskInputDetailItems");
				
				for(var i=0;i<AllList.length;i++){
					for(var j=0;j<selectTaskInputDetailItems.length;j++){
						if(AllList[i].Model==selectTaskInputDetailItems[j].Model){
							vm_task_input_meter.meterItemList.push(AllList[i]);
						}
					}
				}
				
			}else{
				mui.toast(data.message);
			}
		});
	}
	window.onload=function(){
//		courseId = $.query.get("courseId"); 
//		classId = $.query.get("classId");
//		console.info("courseId:  "+courseId);
//		console.info("classId:  "+classId);
		
	}
	 
	function saveMeterInput(){		
		var userInfo = app.getState();
		var searchData=userInfo;
		var ID=[];
		var Result=[];
		for(var i=0;i<vm_task_input_meter.meterItemList.length;i++){
			ID.push(vm_task_input_meter.meterItemList[i].ID);
			Result.push(vm_task_input_meter.meterItemList[i].Result);
		}
		searchData.ID=ID;
		searchData.Result=Result;
		vm_task_input_meter.taskSearchInfo.command="save";
		vm_task_input_meter.taskSearchInfo.data=""+JSON.stringify(searchData);
		app.postCheckList(vm_task_input_meter.taskSearchInfo,function(data){
			if(data.code==1){
				var dataList = data.data; 
				console.info(dataList); 
			}else{
				mui.toast(data.message);
			}
		});
	}
	
</script>
</body>
</html>